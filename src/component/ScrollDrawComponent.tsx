// src/components/ScrollLine.tsx
import { useRef } from "react";
import gsap from "gsap";
import { ScrollTrigger } from "gsap/ScrollTrigger";
import { useGSAP } from "@gsap/react";

gsap.registerPlugin(ScrollTrigger, useGSAP);

interface Props {
  drawDistance?: number; // controls how long the drawing takes
  strokeColor?: string;
  strokeWidth?: number;
}

const ScrollLine: React.FC<Props> = ({
  drawDistance = 1000,
  strokeColor = "#CFE9FF",
  strokeWidth = 4,
}) => {
  const scope = useRef<HTMLDivElement | null>(null);
  const pathRef = useRef<SVGPathElement | null>(null);

  useGSAP(
    () => {
      const path = pathRef.current;
      if (!path) return;

      const length = path.getTotalLength();

      // prepare stroke
      gsap.set(path, {
        strokeDasharray: length,
        strokeDashoffset: length,
        opacity: 1,
      });

      // animate stroke with scroll
      gsap.to(path, {
        strokeDashoffset: 0,
        ease: "none",
        scrollTrigger: {
          trigger: scope.current,
          start: "top center",
          end: `+=${drawDistance}`,
          scrub: true,
        },
      });
    },
    { scope }
  );

  return (
    <div ref={scope} className="relative h-[200vh] bg-[#0C3457]">
      <svg
        className="absolute inset-0 w-full h-full"
        viewBox="0 0 1000 2000"
        preserveAspectRatio="none"
      >
        <path
          ref={pathRef}
          d="M82.173 97.2774C78.9769 97.2774 66.9604 95.5055 54.354 90.3287C36.6169 83.0451 30.5636 73.3041 13.9611 60.1412C7.29555 54.8565 3.98135 48.8861 2.02718 41.1364C-0.669835 30.4408 2.33423 21.2903 6.38758 16.7154C17.2099 4.50047 36.8324 7.35936 46.7578 9.9563C57.7743 12.8387 69.5958 38.408 80.4544 62.0845C82.2968 66.1019 83.431 68.1452 84.3708 67.7861C98.3447 62.446 89.62 29.6893 93.3087 18.1177C95.6325 10.828 100.637 6.00272 104.71 3.5919C108.402 1.40714 115.905 1.65304 124.45 2.4319C127.939 2.74998 129.453 4.5969 130.483 6.67781C136.931 19.7099 130.396 39.637 116.283 65.445C109.661 77.5548 159.468 55.9094 182.718 55.5125C198.113 55.2497 207.834 66.2714 212.879 74.3995C215.613 78.8045 214.354 85.0722 213.777 90.6888C213.19 96.3992 208.562 100.667 203.665 103.756C188.03 113.618 159.809 105.765 141.769 96.1061C137.811 93.9872 135.32 93.8703 133.787 95.2347C130.141 98.4798 131.643 106.24 133.28 112.988C136.564 126.524 150.27 137.849 156.398 147.305C157.625 149.198 157.514 151.505 157.198 153.717C156.882 155.929 155.919 158.201 154.238 159.896C143.736 170.48 118.042 163.117 109.559 158.032C99.0838 151.754 102.571 130.954 100.781 122.959C97.8509 109.873 83.3546 148.796 79.9984 162.325C78.6077 167.931 74.5541 172.85 69.8513 177.736C59.8776 188.098 40.8046 189.656 31.7924 189.066C28.2126 188.832 26.9201 186.739 26.1679 183.827C22.7083 170.434 35.3786 154.292 44.8878 142.638C54.6214 130.709 84.5699 121.445 102.573 110.481C105.543 108.673 106.658 106.463 107.621 104.432C108.584 102.401 108.993 100.116 107.938 98.3957C105.556 94.5134 99.5851 93.7321 95.2051 92.6115C93.0182 92.0519 90.7506 92.2304 89.0354 93.421C81.2908 98.7967 83.9306 109.329 84.8019 114.178C85.1898 116.337 87.4159 117.295 89.6705 117.864C94.5194 119.087 99.3851 117.603 104.377 114.487C112.273 109.557 116.273 102.691 116.859 98.5825C117.162 96.4592 116.259 94.1709 114.123 91.7806C109.096 86.1565 102.229 83.7424 97.238 82.6572C94.6194 82.0878 91.7018 82.1573 89.8914 83.5592C81.0598 90.3985 87.7422 105.945 94.1528 125.146C106.812 163.063 122.788 188.964 132.111 206.866C142.38 226.582 139.824 275.553 136.963 306.092C135.584 320.801 128.531 331.855 126.868 350.241C123.044 392.536 123.502 424.597 126.65 432.254C132.521 446.537 144.208 453.391 160.06 462.154C170.611 467.986 181.581 467.725 189.531 473.353C197.566 479.043 197.532 495.116 196.123 506.869C194.444 520.887 157.803 544.415 128.823 554.484C110.263 560.933 124.053 509.759 129.733 501.125C138.236 488.2 152.403 486.15 176.192 478.276C182.507 476.186 188.223 476.862 191.727 478.1C197.533 480.153 198.165 493.403 198.086 508.142C198.04 516.85 194.762 521.588 190.96 526.38C180.189 539.952 159.406 544.441 138.697 547.786C133.723 548.59 128.314 548.079 124.741 547.064C97.8537 539.427 119.576 470.538 125.203 459.721C131.481 447.653 167.978 449.135 185.471 455.953C206.651 464.208 198.976 495.635 197.859 512.151C197.288 520.585 187.772 523.988 181.764 526.204C158.768 534.686 126.375 529.178 122.354 527.856C110.18 523.852 95.0468 488.678 85.6129 465.723C82.4019 457.909 82.1919 448.26 83.0844 438.907C83.491 434.646 86.8556 431.941 90.2341 430.027C116.333 415.245 168.022 429.198 185.984 436.124C192.58 438.668 196.911 443.563 200.58 448.919C217.214 473.201 207.147 522.558 203.426 534.963C199.612 547.676 183.092 554.799 164.88 560.828C151.228 565.348 139.549 564.236 133.612 563.445C130.476 563.027 127.383 561.07 125.37 559.041C107.267 540.795 125.086 481.856 134.081 457.372C137.684 447.565 143.761 441.225 148.671 436.599C153.048 432.476 159.486 431.87 165.759 431.432C172.328 430.972 178.961 433.117 185.074 437.065C198.657 445.838 200.869 465.437 202.908 483.863C204.092 494.569 198.781 505.954 192.604 516.472C180.445 537.178 153.977 546.088 130.856 552.556C119.989 555.597 110.007 553.873 102.121 551.755C94.3518 549.667 88.8294 544.013 84.6777 538.961C80.7432 534.172 80.2788 526.115 80.342 516.489C80.4943 493.291 102.408 472.408 121.079 457.95C129.054 451.774 138.608 451.489 146.269 451.244C154.061 450.994 161.737 455.548 168.793 461.711C183.697 474.727 186.653 495.758 189.004 511.821C190.074 519.14 187.743 525.809 184.216 531.173C179.05 535.576 172.678 538.593 166.202 540.296C163.024 540.979 160.069 541.295 157.023 541.622" 
          stroke={strokeColor}
          strokeWidth={strokeWidth}
          fill="none"
          opacity="0"
        />
      </svg>
    </div>
  );
};

export default ScrollLine;
